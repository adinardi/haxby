#!/usr/bin/env bash

# Major portions of logic below inspired by https://github.com/jayferd/balls

HAXBY_LIB=$(dirname $0)/../lib
if which greadlink >/dev/null 2>&1
then
    function readlink {
        greadlink $@
    }
fi
HAXBY_LIB=$(readlink -f "$HAXBY_LIB")

mode=$1
shift

while getopts 'c:' opt; do
    case $opt in
        c)
            HAXBY_CONF=$OPTARG
        ;;
    esac
done

[[ -n "$HAXBY_CONF" ]] && . "$HAXBY_CONF"

. $HAXBY_LIB/haxby.sh

for haxby_mode in $HAXBY_MODES
do
    if [ "$haxby_mode" == "$mode" ]; then
        haxby::$mode
        exit $?
    fi
done

echo "Unknown Mode"
echo "Supported Modes: $HAXBY_MODES"
exit 1
